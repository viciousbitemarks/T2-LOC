$asciiLines = @"
 ___      _______  _______             _______  _______ 
|   |    |       ||     __|           |       ||       |
|   |    |   _   ||    |      ____    |_     _||____   |
|   |    |  | |  ||    |     |____|     |   |   ____|  |
|   |___ |  |_|  ||    |                |   |  | ______|
|       ||       ||    |__              |   |  | |_____ 
|_______||_______||_______|             |___|  |_______|
"@ -split "`n"

foreach ($line in $asciiLines) {
    Write-Host $line.Trim() -ForegroundColor Cyan
    Start-Sleep -Milliseconds 50
}

Write-Host ""
Write-Host "All rights reserved to @hexbag." -ForegroundColor Blue
Write-Host "Astro contributed to this project." -ForegroundColor Blue
Write-Host ""
Write-Host "Discord: https://discord.gg/locx" -ForegroundColor White
Write-Host ""

function Show-LoadingBar {
    Write-Host "Starting system verification..." -ForegroundColor White
    for ($i = 0; $i -le 10; $i++) {
        $percent = $i * 10
        $bar = "=" * $i + ">" + "-" * (9 - $i)
        Write-Host -NoNewline "`rScanning: [$bar] $percent% " -ForegroundColor Cyan
        Start-Sleep -Milliseconds 250
    }
    Write-Host "`rScanning: [==========] 100% " -ForegroundColor Green
    Write-Host "Scan complete!" -ForegroundColor Green
    Start-Sleep -Milliseconds 500
    Write-Host "Displaying results..." -ForegroundColor White
    Start-Sleep -Milliseconds 800
    Write-Host ""
}

Show-LoadingBar

Import-Module Defender -ErrorAction SilentlyContinue

$modulesOutput = @()
$osOutput = @()
$memoryIntegrityOutput = @()
$defenderStatusOutput = @()
$exclusionsOutput = @()
$activeThreatsOutput = @()
$threatCatalogOutput = @()
$historyOutput = @()
$powershellSigOutput = @()
$prefetchOutput = @()
$keyAuthOutput = @()
$isabelleOutput = @()
$muiCacheOutput = @()
$vmOutput = @()

$totalChecks = 14
$passedChecks = 0

# <----------- PowerShell Modules and Files Integrity ----------->
$suspiciousModules = @("solara", "xeno", "delta", "arceus", "codex", "bunni", "wave", "cryptic", "swift", "velocity", "sirhurt", "awpgg", "terbium", "chaos", "nezu", "cheat", "exploit", "injector", "bypass", "robloxhack")
$modulesPath = "C:\Program Files\WindowsPowerShell\Modules"
$modulePassed = $true

Get-ChildItem $modulesPath -Directory -ErrorAction SilentlyContinue | ForEach-Object {

    $module = $_
    $moduleName = $_.Name.ToLower()

    foreach ($kw in $suspiciousModules) {
        if ($moduleName -like "*$kw*") {
            $modulePassed = $false
            return
        }
    }
    Get-ChildItem $module.FullName -Recurse -File -ErrorAction SilentlyContinue | ForEach-Object { 
        $file = $_
        $fileName = $file.Name.ToLower()

        foreach($kw in $suspiciousModules){
            if($fileName -like "*$kw*"){
                $modulePassed = $false
                return
            }
        }
        if($file.Extension -in ".exe",".dll"){
            $sig = Get-AuthenticodeSignature $file.FullName
            if($sig.Status -ne "Valid" -or $sig.SignerCertificate.Subject -notlike "*Microsoft"){
                $modulePassed = $false
                return
            }
        }
    }
}
if($modulePassed){
    $modulesOutput += "SUCCESS: Powershell modules are clean."
    $passedChecks++
}else{
    $modulesOutput += "FAILURE: Powershell modules contain malicious keywords."
}
# <----------- OS Authenticity Check ----------->
try {
    if ($env:OS -eq "Windows_NT" -and (Get-CimInstance Win32_OperatingSystem)) {
        $osOutput += "SUCCESS: OS verified."
        $passedChecks++
    } else {
        $osOutput += "FAILURE: OS verification failed."
    }
} catch {
    $osOutput += "FAILURE: OS check error."
}

# <----------- Memory Integrity Check ----------->
try {
    $regPath = "HKLM:\SYSTEM\CurrentControlSet\Control\DeviceGuard\Scenarios\HypervisorEnforcedCodeIntegrity"
    $enabled = Get-ItemPropertyValue -Path $regPath -Name "Enabled" -ErrorAction Stop
    if ($enabled -eq 1) {
        $memoryIntegrityOutput += "SUCCESS: Memory Integrity enabled."
        $passedChecks++
    } else {
        $memoryIntegrityOutput += "FAILURE: Memory Integrity disabled."
    }
} catch {
    $memoryIntegrityOutput += "WARNING: Memory Integrity status unavailable."
}

# <----------- Defender Status and Realtime Protection ----------->
try {
    $status = Get-MpComputerStatus
    if ($status.AntivirusEnabled -and $status.AMServiceEnabled -and $status.RealTimeProtectionEnabled) {
        $defenderStatusOutput += "SUCCESS: Defender fully active."
        $passedChecks++
    } else {
        try {
            Set-MpPreference -DisableRealtimeMonitoring $false
        } catch {}
        $defenderStatusOutput += "FAILURE: Defender issues detected."
    }
} catch {
    $defenderStatusOutput += "WARNING: Defender status query failed."
}

# <----------- Defender Exclusions Check ----------->
try {
    $exclusions = (Get-MpPreference).ExclusionPath
    if (-not $exclusions -or $exclusions.Count -eq 0) {
        $exclusionsOutput += "SUCCESS: No exclusions."
        $passedChecks++
    } else {
        $exclusionsOutput += "FAILURE: Exclusions present."
    }
} catch {
    $exclusionsOutput += "WARNING: Exclusions check failed."
}

# <----------- Active Threats Check ----------->
try {
    $threats = Get-MpThreatDetection
    if (-not $threats -or $threats.Count -eq 0) {
        $activeThreatsOutput += "SUCCESS: No active threats."
        $passedChecks++
    } else {
        $activeThreatsOutput += "FAILURE: Threats detected."
    }
} catch {
    $activeThreatsOutput += "WARNING: Threats query failed."
}

# <----------- Threat Catalog Check ----------->
try {
    $catalog = Get-MpThreat
    $bad = $catalog | Where-Object { $_.Status -in "Active","Allowed" -or -not $_.ActionSuccess }
    if (-not $bad -or $bad.Count -eq 0) {
        $threatCatalogOutput += "SUCCESS: Threat catalog clean."
        $passedChecks++
    } else {
        $threatCatalogOutput += "FAILURE: Issues in threat catalog."
    }
} catch {
    $threatCatalogOutput += "WARNING: Catalog check failed."
}

# <----------- Defender Detection History (Last 24 Hours) ----------->
try {
    $since = (Get-Date).AddHours(-24)
    $historyPath = "$env:ProgramData\Microsoft\Windows Defender\Scans\History\Service\DetectionHistory"
    $recent = $false
    if (Test-Path $historyPath) {
        $files = Get-ChildItem $historyPath -Recurse -Filter "*.json" -ErrorAction SilentlyContinue
        foreach ($f in $files) {
            $json = Get-Content $f.FullName -Raw | ConvertFrom-Json -ErrorAction SilentlyContinue
            if ($json.TimeStamp) {
                $ts = Get-Date $json.TimeStamp -ErrorAction SilentlyContinue
                if ($ts -and $ts -ge $since) { $recent = $true }
            }
        }
    }
    if (-not $recent) {
        $historyOutput += "SUCCESS: No recent detections."
        $passedChecks++
    } else {
        $historyOutput += "FAILURE: Recent detections found."
    }
} catch {
    $historyOutput += "WARNING: History check error."
}

# <----------- PowerShell Binary Signature Check ----------->
try {
    $psPath = "$env:SystemRoot\System32\WindowsPowerShell\v1.0\powershell.exe"
    $sig = Get-AuthenticodeSignature $psPath
    if ($sig.Status -eq "Valid" -and $sig.SignerCertificate.Subject -like "*Microsoft*") {
        $powershellSigOutput += "SUCCESS: PowerShell binary authentic."
        $passedChecks++
    } else {
        $powershellSigOutput += "FAILURE: Binary invalid."
    }
} catch {
    $powershellSigOutput += "WARNING: Binary check failed."
}

# <----------- Prefetch Suspicious Entries ----------->
try {
    $pfPath = "C:\Windows\Prefetch"
    $watchlist = @("ISABELLE.EXE", "EVOLVE.EXE", "KEYAUTH.EXE", "SYNAPSE.EXE", "JJSPLASH.EXE", "FLUXUS.EXE", "DELTA.EXE")
    $suspicious = $false
    if (Test-Path $pfPath) {
        $files = Get-ChildItem $pfPath -Filter "*.pf" -ErrorAction SilentlyContinue
        foreach ($f in $files) {
            $base = $f.BaseName.ToUpper()
            if ($watchlist -contains "$base.EXE") {
                $suspicious = $true
            }
        }
    }
    if (-not $suspicious) {
        $prefetchOutput += "SUCCESS: No suspicious prefetch traces."
        $passedChecks++
    } else {
        $prefetchOutput += "FAILURE: Suspicious prefetch traces found."
    }
} catch {
    $prefetchOutput += "WARNING: Prefetch check failed."
}

# <----------- KeyAuth Cheat Folders Check ----------->
try {
    $keyPath = "C:\ProgramData\KeyAuth\debug"
    $folders = Get-ChildItem $keyPath -Directory -ErrorAction SilentlyContinue
    if (-not $folders -or $folders.Count -eq 0) {
        $keyAuthOutput += "SUCCESS: No suspicious folders."
        $passedChecks++
    } else {
        $keyAuthOutput += "FAILURE: Suspicious folders detected."
    }
} catch {
    $keyAuthOutput += "SUCCESS: Area clean."
    $passedChecks++
}

# <----------- Isabelle Exploit Check ----------->
try {
    $folder = Test-Path "$env:APPDATA\Isabelle"
    if (-not $folder) {
        $isabelleOutput += "SUCCESS: No exploit indicators."
        $passedChecks++
    } else {
        $isabelleOutput += "FAILURE: Exploit indicators found."
    }
} catch {
    $isabelleOutput += "WARNING: Check failed."
}

# <----------- MuiCache Suspicious Entries ----------->
try {
    $muiPath = "HKCU:\SOFTWARE\Classes\Local Settings\Software\Microsoft\Windows\Shell\MuiCache"
    $blacklist = @("solara","xeno","delta","arceus","codex","bunni","wave","cryptic","swift","velocity","sirhurt","awpgg","terbium","chaos","nezu","cheat","exploit","injector","bypass")
    $suspiciousFiles = @()
    $entries = Get-ItemProperty $muiPath -ErrorAction SilentlyContinue
    if ($entries) {
        $properties = $entries.PSObject.Properties
        foreach ($prop in $properties) {
            if (\( prop.Name -match '\.exe \)') {
                $lower = $prop.Name.ToLower()
                foreach ($word in $blacklist) {
                    if ($lower -like "*$word*") {
                        $suspiciousFiles += $prop.Name
                        break
                    }
                }
            }
        }
    }
    if ($suspiciousFiles.Count -eq 0) {
        $muiCacheOutput += "SUCCESS: No suspicious executed programs."
        $passedChecks++
    } else {
        $muiCacheOutput += "FAILURE: Suspicious executed programs found."
        foreach ($file in $suspiciousFiles) {
            Write-Host "Detected: $file" -ForegroundColor Red
        }
    }
} catch {
    $muiCacheOutput += "WARNING: Registry check failed."
}

# <----------- Virtual Machine Detection ----------->
$vmDetected = $false
try {
    $computerSystem = Get-WmiObject Win32_ComputerSystem
    if ($computerSystem.Manufacturer -like "*VMware*" -or $computerSystem.Model -like "*Virtual*") {
        $vmDetected = $true
    }
    $bios = Get-WmiObject Win32_BIOS
    if ($bios.SMBIOSBIOSVersion -like "*Hyper-V*" -or $bios.SMBIOSBIOSVersion -like "*VMware*") {
        $vmDetected = $true
    }
    $services = Get-Service -Name "*vmware*" -ErrorAction SilentlyContinue
    if ($services) {
        $vmDetected = $true
    }
    $regKeys = @("HKLM:\SOFTWARE\VMware, Inc.", "HKLM:\SOFTWARE\Oracle\VirtualBox Guest Additions")
    foreach ($key in $regKeys) {
        if (Test-Path $key) {
            $vmDetected = $true
            break
        }
    }
} catch {
    $vmOutput += "WARNING: VM check failed."
}
if (-not $vmDetected) {
    $vmOutput += "SUCCESS: Not running in VM."
    $passedChecks++
} else {
    $vmOutput += "FAILURE: Running in virtual machine."
}

$successRate = [math]::Round(($passedChecks / $totalChecks) * 100)

function Write-Section {
    param($Title, $Lines)
    Write-Host "--- $Title ---" -ForegroundColor Cyan
    foreach ($line in $Lines) {
        if ($line -like "SUCCESS*") { Write-Host $line -ForegroundColor Green }
        elseif ($line -like "FAILURE*") { Write-Host $line -ForegroundColor Red }
        elseif ($line -like "WARNING*") { Write-Host $line -ForegroundColor Yellow }
        else { Write-Host $line -ForegroundColor White }
    }
    Write-Host ""
}

Write-Section "PowerShell Environment" $modulesOutput
Write-Section "OS Verification" $osOutput
Write-Section "Memory Integrity" $memoryIntegrityOutput
Write-Section "Defender Status" $defenderStatusOutput
Write-Section "Exclusions" $exclusionsOutput
Write-Section "Active Threats" $activeThreatsOutput
Write-Section "Threat Catalog" $threatCatalogOutput
Write-Section "Recent Detections" $historyOutput
Write-Section "PowerShell Binary" $powershellSigOutput
Write-Section "Prefetch Traces" $prefetchOutput
Write-Section "Suspicious Folders" $keyAuthOutput
Write-Section "Exploit Indicators" $isabelleOutput
Write-Section "Executed Programs" $muiCacheOutput
Write-Section "Virtual Machine" $vmOutput

Write-Host "--- Summary ---" -ForegroundColor Cyan
$summaryColor = if ($successRate -eq 100) { "Green" } elseif ($successRate -ge 80) { "Yellow" } else { "Red" }
Write-Host "Success Rate: $successRate% ($passedChecks / $totalChecks)" -ForegroundColor $summaryColor
Write-Host "Verification complete." -ForegroundColor White
